/*
 *  JS-Leri - JavaScript LR-Parsing Module 1.1.2
 *
 *  Another parser module which allows writing the language in plain JavaScript.
 *  This project was inspired by lrparsing (http://lrparsing.sourceforge.net/), a Python
 *  parser written by Russell Stuart, 2014-05-29.
 *
 *  copyright 2015, Jeroen van der Heijden (Transceptor Technology)
 */
'use strict';(function(){var a={};a.noop=function(){};var b=/^\s+/;var c=/^\w+/;var d=/\s+/;var e=function(a){return typeof a==='function';};var f=function(a){if(typeof a==='string'&&a.indexOf('^',0)!==0)a='^'+a;return new RegExp(a);};var g=function(a,b){return a.length<b.length;};var h=function(a,c,d,e){var f=new A();var g=function(a,b,d){if(d>f.pos)f.empty();b.end=d;b.str=c.substring(b.start,b.end);a.push(b);};var h=function(a,d,p,q,u){var x,A,B,C,D,E,F,G,H;x=c.substring(d).replace(b,'');G=new z(a,c.length-x.length);f.setModeRequired(G.start,u);if(a instanceof i){H=new y(false,G.start);for(C=0,D=a.elements.length;C<D;C++){F=[];B=h(a.elements[C],G.start,F,q,true);if(B.isValid&&B.pos>H.pos){G.children=F;H=B;}}if(H.isValid)g(p,G,H.pos);return H;}if(a instanceof j){E=x.match(e);A=a.ignCase?Boolean(E&&E[0].toLowerCase()===a.keyword.toLowerCase()):Boolean(E&&E[0]===a.keyword);if(A)g(p,G,G.start+a.keyword.length);else f.update(a,G.start);return new y(A,G.end||G.start);}if(a instanceof k){d=G.start;for(C=0,D=0;;){B=h(a.element,d,G.children,q,C<a.min);if(!B.isValid)break;d=B.pos;C++;B=h(a.delimiter,d,G.children,q,C<a.min);if(!B.isValid)break;d=B.pos;D++;}A=(!(C<a.min||(a.max&&C>a.max)||(!a.opt&&C&&C==D)));if(A)g(p,G,d);return new y(A,d);}if(a instanceof l){B=h(a.element,G.start,G.children,q,false);if(B.isValid)g(p,G,B.pos);return new y(true,G.end||G.start);}if(a instanceof m){if(q._tested[G.start]===undefined)q._tested[G.start]=new y(false,G.start);for(C=0,D=a.elements.length;C<D;C++){F=[];B=h(a.elements[C],G.start,F,q,true);if(B.isValid&&B.pos>q._tested[G.start].pos){G.children=F;q._tested[G.start]=B;q._tree[G.start]=F;}}if(q._tested[G.start].isValid)g(p,G,q._tested[G.start].pos);return q._tested[G.start];}if(a instanceof n){E=x.match(a._re);A=Boolean(E);if(A)g(p,G,G.start+E[0].length);else f.update(a,G.start);return new y(A,G.end||G.start);}if(a instanceof o){d=G.start;for(C=0;!a.max||C<a.max;C++){B=h(a.element,d,G.children,q,C<a.min);if(!B.isValid)break;d=B.pos;}A=(C>=a.min);if(A)g(p,G,d);return new y(A,d);}if(a instanceof r){a._tested={};a._tree={};B=h(a.element,G.start,G.children,a,true);if(B.isValid)g(p,G,B.pos);return B;}if(a instanceof s){d=G.start;for(C=0,D=a.elements.length;C<D;C++){B=h(a.elements[C],d,G.children,q,true);if(B.isValid)d=B.pos;else return B;}g(p,G,B.pos);return B;}if(a instanceof v){A=Boolean(x.indexOf(a.token)===0);if(A)g(p,G,G.start+a.token.length);else f.update(a,G.start);return new y(A,G.end||G.start);}if(a instanceof w){for(C=0,D=a.tokens.length;C<D;C++)if(x.indexOf(a.tokens[C])===0){g(p,G,G.start+a.tokens[C].length);return new y(true,G.end);}f.update(a,G.start);return new y(false,G.start);}if(a instanceof t){if(q._tested[G.start]===undefined){q._tested[G.start]=h(q.element,G.start,G.children,q,true);q._tree[G.start]=G.children;}else G.children=q._tree[G.start];if(q._tested[G.start].isValid)g(p,G,q._tested[G.start].pos);return q._tested[G.start];}};var p=h(a,0,d,a,true);var q=c.substring(p.pos).replace(b,'');if(p.isValid&&q)p.isValid=false;if(!f.required.length&&q){f.setModeRequired(p.pos,true);f.update(new x(p.pos),p.pos);}p.expecting=f.getExpecting();if(!p.isValid)p.pos=f.pos;return p;};function i(){var a=B.call(this,i,arguments);if(a)return a;this.elements=this.checkElements(this.args);}i.prototype=Object.create(B.prototype);i.prototype.constzructor=i;a.Choice=i;function j(a,b){var c=B.call(this,j,arguments);if(c)return c;a=this.args[0];b=this.args[1];this.keyword=a;this.ignCase=Boolean(b);}j.prototype=Object.create(B.prototype);j.prototype.constructor=j;a.Keyword=j;var k=function k(a,b,c,d,e){var f=B.call(this,k,arguments);if(f)return f;a=this.args[0];b=(this.args[1]===undefined)?new v(','):this.args[1];c=this.args[2];d=this.args[3];e=this.args[4];if(!(a instanceof B))throw '(Jsleri-->List) first argument must be an instance of Jsleri; got '+typeof a;if(typeof b!=='string'&&!(b instanceof B))throw '(Jsleri-->List) second argument must be a string or instance of Jsleri; got '+typeof b;this.element=a;this.delimiter=(b instanceof B)?b:new v(b);this.min=(c===undefined||c===null)?0:c;this.max=(d===undefined||d===null)?null:d;this.opt=Boolean(e);};k.prototype=Object.create(B.prototype);k.prototype.constructor=k;a.List=k;function l(a){var b=B.call(this,l,arguments);if(b)return b;a=this.args[0];if(!(a instanceof B))throw '(Jsleri-->Optional) first argument must be an instance of Jsleri; got '+typeof a;this.element=a;}l.prototype=Object.create(B.prototype);l.prototype.constructor=l;a.Optional=l;function m(){var a=B.call(this,m,arguments);if(a)return a;this.elements=this.checkElements(this.args);return new r(this);}m.prototype=Object.create(B.prototype);m.prototype.constructor=m;a.Prio=m;function n(a,b){var c=B.call(this,n,arguments);if(c)return c;a=this.args[0];b=this.args[1];this.re=a;this._re=new RegExp('^'+a,Boolean(b)?'i':undefined);}n.prototype=Object.create(B.prototype);n.prototype.constructor=n;a.Regex=n;function o(a,b,c){var d=B.call(this,o,arguments);if(d)return d;a=this.args[0];b=this.args[1];c=this.args[2];if(!(a instanceof B))throw '(Jsleri-->Repeat) first argument must be an instance of Jsleri; got '+typeof a;this.element=a;this.min=(b===undefined||b===null)?0:b;this.max=(c===undefined||c===null)?null:c;}o.prototype=Object.create(B.prototype);o.prototype.constructor=o;a.Repeat=o;function p(a){var b=function(){};b.prototype=a.prototype;var c=B.call(this,b,arguments);if(c)return c;}p.prototype=Object.create(B.prototype);p.prototype.constructor=p;a.Ref=p;function q(a,b){var d=B.call(this,q,arguments);if(d)return d;a=this.args[0];b=this.args[1];if(!(a instanceof B))throw '(Jsleri-->Optional) first argument must be an instance of Jsleri; got '+typeof a;this.reKeywords=(b===undefined)?c:f(b);this.element=a;this.parse=function(b){var c=new z(this,0,b.length,b);var d=h(a,b,c.children,this.reKeywords);d.tree=c;return d;};}q.prototype=Object.create(B.prototype);q.prototype.constructor=q;a.Grammar=q;function r(a){var b=B.call(this,r,arguments);if(b)return b;a=this.args[0];if(!(a instanceof B))throw '(Jsleri-->Rule) first argument must be an instance of Jsleri; got '+typeof a;this.element=a;}r.prototype=Object.create(B.prototype);r.prototype.constructor=r;function s(){var a=B.call(this,s,arguments);if(a)return a;this.elements=this.checkElements(this.args);}s.prototype=Object.create(B.prototype);s.prototype.constructor=s;a.Sequence=s;var t=function(){if(!(this instanceof t))return new t();};t.prototype=Object.create(B.prototype);t.prototype.constructor=t;var u=new t();a.THIS=u;function v(a){var b=B.call(this,v,arguments);if(b)return b;a=this.args[0];if(typeof a!=='string')throw '(Jsleri-->Token) first argument must be a string; got '+typeof a;this.token=a;}v.prototype=Object.create(B.prototype);v.prototype.constructor=v;a.Token=v;function w(a){var b=B.call(this,w,arguments);if(b)return b;a=this.args[0];if(typeof a!=='string')throw '(Jsleri-->Tokens) first argument must be a string; got '+typeof a;this.tokens=a.split(d).sort(g);}w.prototype=Object.create(B.prototype);w.prototype.constructor=w;a.Tokens=w;function x(){this.e='End of statement';}x.prototype=Object.create(B.prototype);x.prototype.constructor=x;a.EndOfStatement=x;function y(a,b){this.isValid=a;this.pos=b;this.expecting=null;}function z(a,b,c,d){this.element=a;this.start=b;this.end=c;this.str=d;this.children=[];}z.prototype.walk=function(){this.element.onEnter(this);for(var a=0,b=this.children.length;a<b;a++)this.children[a].walk();this.element.onExit(this);};function A(){this.required=[];this.optional=[];this.pos=0;this._modes=[this.required];}A.prototype.setModeRequired=function(a,b){if(this._modes[a]!==this.optional)this._modes[a]=(b===false)?this.optional:this.required;};A.prototype.empty=function(){this.required.length=0;this.optional.length=0;};A.prototype.update=function(a,b){if(b>this.pos){this.empty();this.pos=b;}if(b===this.pos&&this._modes[b].indexOf(a)===-1)this._modes[b].push(a);};A.prototype.getExpecting=function(){return this.required.concat(this.optional);};function B(a,b){b=Array.prototype.slice.call(b);if(!(this instanceof a))return new (a.bind.apply(a,[a].concat(b)))();this.setCallbacks(b);this.args=b;}B.prototype.setCallbacks=function(a){var b=a[0];if(b===undefined||b===null||typeof b==='string'||b instanceof B)return;if(e(b.onEnter))this.onEnter=b.onEnter;if(e(b.onExit))this.onExit=b.onExit;a.splice(0,1);};B.prototype.onEnter=a.noop;B.prototype.onExit=a.noop;B.prototype.checkElements=function(a){var b=0,c=a.length;if(c===0)throw '(Jsleri-->'+this.constructor.name+') Need at least one Jsleri argument';for(;b<c;b++)if(!(a[b] instanceof B))a[b]=new v(a[b]);return a;};B.prototype.checkElement=function(a){if(!(a instanceof B))a=new v(a);return a;};window.jsleri=a;})();