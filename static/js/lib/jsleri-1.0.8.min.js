/*
 *  JS-Leri - JavaScript LR-Parsing Module 1.0.8
 *
 *  Another parser module which allows writing the language in plain JavaScript.
 *  This project was inspired by lrparsing (http://lrparsing.sourceforge.net/), a Python
 *  parser written by Russell Stuart, 2014-05-29.
 *
 *  copyright 2015, Jeroen van der Heijden (Transceptor Technology)
 */
'use strict';(function(){var a={};a.noop=function(){};var b=/^\s+/;var c=/^\w+/;var d=/\s+/;var e=function(a){return typeof a==='function';};var f=function(a){return new RegExp('^'+a);};var g=function(a,b){return a.length<b.length;};var h=function(a,c,d,e){var f=new z();var g=function(a,b,d){if(d>f.pos)f.empty();b.end=d;b.str=c.substring(b.start,b.end);a.push(b);};var h=function(a,d,p,t,w){var z,A,B,C,D,E,F,G,H;z=c.substring(d).replace(b,'');G=new y(a,c.length-z.length);f.setModeRequired(G.start,w);if(a instanceof i){H=new x(false,G.start);for(C=0,D=a.elements.length;C<D;C++){F=[];B=h(a.elements[C],G.start,F,t,true);if(B.isValid&&B.pos>H.pos){G.children=F;H=B;}}if(H.isValid)g(p,G,H.pos);return H;}if(a instanceof j){E=z.match(e);A=Boolean(E&&E[0]===a.keyword);if(A)g(p,G,G.start+a.keyword.length);else f.update(a,G.start);return new x(A,G.end||G.start);}if(a instanceof k){d=G.start;for(C=0,D=0;;){B=h(a.element,d,G.children,t,C<a.min);if(!B.isValid)break;d=B.pos;C++;B=h(a.delimiter,d,G.children,t,C<a.min);if(!B.isValid)break;d=B.pos;D++;}A=(!(C<a.min||(a.max&&C>a.max)||(!a.opt&&C&&C==D)));if(A)g(p,G,d);return new x(A,d);}if(a instanceof l){B=h(a.element,G.start,G.children,t,false);if(B.isValid)g(p,G,B.pos);return new x(true,G.end||G.start);}if(a instanceof m){if(t._tested[G.start]===undefined)t._tested[G.start]=new x(false,G.start);for(C=0,D=a.elements.length;C<D;C++){F=[];B=h(a.elements[C],G.start,F,t,true);if(B.isValid&&B.pos>t._tested[G.start].pos){G.children=F;t._tested[G.start]=B;t._tree[G.start]=F;}}if(t._tested[G.start].isValid)g(p,G,t._tested[G.start].pos);return t._tested[G.start];}if(a instanceof n){E=z.match(a._re);A=Boolean(E);if(A)g(p,G,G.start+E[0].length);else f.update(a,G.start);return new x(A,G.end||G.start);}if(a instanceof o){d=G.start;for(C=0;!a.max||C<a.max;C++){B=h(a.element,d,G.children,t,C<a.min);if(!B.isValid)break;d=B.pos;}A=(C>=a.min);if(A)g(p,G,d);return new x(A,d);}if(a instanceof q){a._tested={};a._tree={};B=h(a.element,G.start,G.children,a,true);if(B.isValid)g(p,G,B.pos);return B;}if(a instanceof r){d=G.start;for(C=0,D=a.elements.length;C<D;C++){B=h(a.elements[C],d,G.children,t,true);if(B.isValid)d=B.pos;else return B;}g(p,G,B.pos);return B;}if(a instanceof u){A=Boolean(z.indexOf(a.token)===0);if(A)g(p,G,G.start+a.token.length);else f.update(a,G.start);return new x(A,G.end||G.start);}if(a instanceof v){for(C=0,D=a.tokens.length;C<D;C++)if(z.indexOf(a.tokens[C])===0){g(p,G,G.start+a.tokens[C].length);return new x(true,G.end);}f.update(a,G.start);return new x(false,G.start);}if(a instanceof s){if(t._tested[G.start]===undefined){t._tested[G.start]=h(t.element,G.start,G.children,t,true);t._tree[G.start]=G.children;}else G.children=t._tree[G.start];if(t._tested[G.start].isValid)g(p,G,t._tested[G.start].pos);return t._tested[G.start];}};var p=h(a,0,d,a,true);var t=c.substring(p.pos).replace(b,'');if(p.isValid&&t)p.isValid=false;if(!f.required.length&&t){f.setModeRequired(p.pos,true);f.update(new w(p.pos),p.pos);}p.expecting=f.getExpecting();if(!p.isValid)p.pos=f.pos;return p;};function i(){var a=A.call(this,i,arguments);if(a)return a;this.elements=this.checkElements(this.args);}i.prototype=Object.create(A.prototype);i.prototype.constructor=i;a.Choice=i;function j(a,b){var c=A.call(this,j,arguments);if(c)return c;a=this.args[0];b=this.args[1];this.keyword=a;this.ignCase=Boolean(b);}j.prototype=Object.create(A.prototype);j.prototype.constructor=j;a.Keyword=j;var k=function k(a,b,c,d,e){var f=A.call(this,k,arguments);if(f)return f;a=this.args[0];b=this.args[1];c=this.args[2];d=this.args[3];e=this.args[4];if(!(a instanceof A))throw '(Jsleri-->List) first argument must be an instance of Jsleri; got '+typeof a;if(typeof b!=='string'&&!(b instanceof A))throw '(Jsleri-->List) second argument must be a string or instance of Jsleri; got '+typeof b;this.element=a;this.delimiter=(b instanceof A)?b:new u(b);this.min=(c===undefined||c===null)?0:c;this.max=(d===undefined||d===null)?null:d;this.opt=Boolean(e);};k.prototype=Object.create(A.prototype);k.prototype.constructor=k;a.List=k;function l(a){var b=A.call(this,l,arguments);if(b)return b;a=this.args[0];if(!(a instanceof A))throw '(Jsleri-->Optional) first argument must be an instance of Jsleri; got '+typeof a;this.element=a;}l.prototype=Object.create(A.prototype);l.prototype.constructor=l;a.Optional=l;function m(){var a=A.call(this,m,arguments);if(a)return a;this.elements=this.checkElements(this.args);return new q(this);}m.prototype=Object.create(A.prototype);m.prototype.constructor=m;a.Prio=m;function n(a,b){var c=A.call(this,n,arguments);if(c)return c;a=this.args[0];b=this.args[1];this.re=a;this._re=new RegExp('^'+a,Boolean(b)?'i':undefined);}n.prototype=Object.create(A.prototype);n.prototype.constructor=n;a.Regex=n;function o(a,b,c){var d=A.call(this,o,arguments);if(d)return d;a=this.args[0];b=this.args[1];c=this.args[2];if(!(a instanceof A))throw '(Jsleri-->Repeat) first argument must be an instance of Jsleri; got '+typeof a;this.element=a;this.min=(b===undefined||b===null)?0:b;this.max=(c===undefined||c===null)?null:c;}o.prototype=Object.create(A.prototype);o.prototype.constructor=o;a.Repeat=o;function p(a,b){var d=A.call(this,p,arguments);if(d)return d;a=this.args[0];b=this.args[1];if(!(a instanceof A))throw '(Jsleri-->Optional) first argument must be an instance of Jsleri; got '+typeof a;this.reKeywords=(b===undefined)?c:f(b);this.element=a;this.parse=function(b){var c=new y(this,0,b.length,b);var d=h(a,b,c.children,this.reKeywords);d.tree=c;return d;};}p.prototype=Object.create(A.prototype);p.prototype.constructor=p;a.Grammar=p;function q(a){var b=A.call(this,q,arguments);if(b)return b;a=this.args[0];if(!(a instanceof A))throw '(Jsleri-->Rule) first argument must be an instance of Jsleri; got '+typeof a;this.element=a;}q.prototype=Object.create(A.prototype);q.prototype.constructor=q;function r(){var a=A.call(this,r,arguments);if(a)return a;this.elements=this.checkElements(this.args);}r.prototype=Object.create(A.prototype);r.prototype.constructor=r;a.Sequence=r;var s=function(){if(!(this instanceof s))return new s();};s.prototype=Object.create(A.prototype);s.prototype.constructor=s;var t=new s();a.THIS=t;function u(a){var b=A.call(this,u,arguments);if(b)return b;a=this.args[0];if(typeof a!=='string')throw '(Jsleri-->Token) first argument must be a string; got '+typeof a;this.token=a;}u.prototype=Object.create(A.prototype);u.prototype.constructor=u;a.Token=u;function v(a){var b=A.call(this,v,arguments);if(b)return b;a=this.args[0];if(typeof a!=='string')throw '(Jsleri-->Tokens) first argument must be a string; got '+typeof a;this.tokens=a.split(d).sort(g);}v.prototype=Object.create(A.prototype);v.prototype.constructor=v;a.Tokens=v;function w(){this.e='End of statement';}w.prototype=Object.create(A.prototype);w.prototype.constructor=w;a.EndOfStatement=w;function x(a,b){this.isValid=a;this.pos=b;this.expecting=null;}function y(a,b,c,d){this.element=a;this.start=b;this.end=c;this.str=d;this.children=[];}y.prototype.walk=function(){this.element.onEnter(this);for(var a=0,b=this.children.length;a<b;a++)this.children[a].walk();this.element.onExit(this);};function z(){this.required=[];this.optional=[];this.pos=0;this._modes=[this.required];}z.prototype.setModeRequired=function(a,b){if(this._modes[a]!==this.optional)this._modes[a]=(b===false)?this.optional:this.required;};z.prototype.empty=function(){this.required.length=0;this.optional.length=0;};z.prototype.update=function(a,b){if(b>this.pos){this.empty();this.pos=b;}if(b===this.pos&&this._modes[b].indexOf(a)===-1)this._modes[b].push(a);};z.prototype.getExpecting=function(){return this.required.concat(this.optional);};function A(a,b){b=Array.prototype.slice.call(b);if(!(this instanceof a))return new (a.bind.apply(a,[a].concat(b)))();this.setCallbacks(b);this.args=b;}A.prototype.setCallbacks=function(a){var b=a[0];if(b===undefined||b===null||typeof b==='string'||b instanceof A)return;if(e(b.onEnter))this.onEnter=b.onEnter;if(e(b.onExit))this.onExit=b.onExit;a.splice(0,1);};A.prototype.onEnter=a.noop;A.prototype.onExit=a.noop;A.prototype.checkElements=function(a){var b=0,c=a.length;if(c===0)throw '(Jsleri-->'+this.constructor.name+') Need at least one Jsleri argument';for(;b<c;b++)if(!(a[b] instanceof A))a[b]=new u(a[b]);return a;};A.prototype.checkElement=function(a){if(!(a instanceof A))a=new u(a);return a;};window.jsleri=a;})();