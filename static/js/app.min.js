'use strict';(function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=k('^[-+]?[0-9]*\\.?[0-9]+');var o=k('^[0-9]+');var p=k('^[0-9]+[smhdw]');var q=k('^(?:\'(?:[^\']*)\')+');var r=k('^(?:"(?:[^"]*)")+');var s=k('^(?:`(?:[^`]*)`)+');var t=k('^[0-9a-f]{8}\\-[0-9a-f]{4}\\-[0-9a-f]{4}\\-[0-9a-f]{4}\\-[0-9a-f]{12}');var u=k('^(/[^/\\\\]*(?:\\\\.[^/\\\\]*)*/i?)');var v=k('^#.*');var w=m('access');var x=m('address');var y=m('after');var z=m('aiohttp_server');var A=m('alter');var B=m('and');var C=m('as');var D=m('before');var E=m('buffer_size');var F=m('buffer_path');var G=m('between');var H=m('cached');var I=m('comment');var J=m('contains');var K=m('continue');var L=m('count');var M=m('create');var N=m('database');var O=m('dbname');var P=m('dbpath');var Q=m('debug');var R=m('derivative');var S=m('difference');var T=m('drop');var U=m('drop_threshold');var V=m('duration_log');var W=m('duration_num');var X=m('end');var Y=m('expression');var Z=m('false');var ab=m('filter');var ac=m('first');var ad=m('for');var ae=m('from');var af=m('full');var ag=m('grant');var ah=m('group');var ai=m('groups');var aj=l(m('help'),f('?'));var ak=m('ignore_threshold');var al=m('indexed');var am=m('insert');var an=l(f('&'),m('intersection'));var ao=m('length');var ap=m('last');var aq=m('license');var ar=m('limit');var as=m('list');var at=m('loglevel');var au=m('manhole');var av=m('max');var aw=m('max_cache_expressions');var ax=m('max_open_files');var ay=m('mean');var az=m('median');var aA=m('median_low');var aB=m('median_high');var aC=m('mem_usage');var aD=m('merge');var aE=m('min');var aF=m('modify');var aG=m('name');var aH=m('network');var aI=m('networks');var aJ=m('now');var aK=m('null');var aL=m('online');var aM=m('open_files');var aN=m('optimize_pool');var aO=m('optimize_task');var aP=m('or');var aQ=m('password');var aR=m('pause');var aS=l(f('*'),m('points'));var aT=m('pool');var aU=m('pools');var aV=m('port');var aW=m('prefix');var aX=m('pvariance');var aY=m('python');var aZ=m('query_timeout');var bc=m('read');var bd=m('received_points');var be=m('reindex_progress');var bf=m('reject');var bg=m('revoke');var bh=m('select');var bi=m('series');var bj=m('server');var bk=m('servers');var bl=m('set');var bm=m('shard');var bn=m('sharding_buffering');var bo=m('sharding_max_chunk_points');var bp=m('shards');var bq=m('show');var br=m('sid');var bs=m('size');var bt=m('start');var bu=m('startup_time');var bv=m('status');var bw=m('suffix');var bx=m('sum');var by=l(f('^'),m('symmetric_difference'));var bz=m('sync_progress');var bA=m('task_queue');var bB=m('timeit');var bC=m('timezone');var bD=m('time_precision');var bE=m('to');var bF=m('true');var bG=m('type');var bH=l(c(', |'),m('union'));var bI=m('uptime');var bJ=m('user');var bK=m('users');var bL=m('using');var bM=m('uuid');var bN=m('variance');var bO=m('version');var bP=m('where');var bQ=m('who_am_i');var bR=m('write');var bS=l(f('-'),S);var bT=l(bc,bR,aF,af,bh,bq,as,L,M,am,T,ag,bg,A,aR,K);var bU=j(o,h(f('('),i,f(')')),h(i,c('// ** + - * %'),i));var bV=l(q,r);var bW=j(p,aJ,bV,o,h(f('('),i,f(')')),h(i,c('// ** + - * %'),i),h(f('-'),o));var bX=l(aG,bG,ao,bt,X,ac,ap,aT);var bY=e(bX,f(','),1,undefined,false);var bZ=l(br,bs,bt,X,bG);var cd=e(bZ,f(','),1,undefined,false);var ce=l(x,aG,aV,bM,aT,bO,aL,bv,F,E,P,Q,at,au,ax,aC,aM,aN,aO,bd,be,bn,bo,bu,bz,bA,bI);var cf=e(ce,f(','),1,undefined,false);var cg=l(H,Y,al,aG,bi);var ch=e(cg,f(','),1,undefined,false);var ci=l(bJ,w);var cj=e(ci,f(','),1,undefined,false);var ck=l(aH,w,I);var cl=e(ck,f(','),1,undefined,false);var cm=l(aT,bk,bi);var cn=e(cm,f(','),1,undefined,false);var co=l(c('== != <= >= < >'),m('in'),h(m('not'),m('in')));var cp=j(bV,bU,bW,Z,bF,aK,bX);var cq=h(bP,j(h(cp,co,cp),h(f('('),i,f(')')),h(i,B,i),h(i,aP,i)));var cr=j(bV,bU,bW,Z,bF,cg);var cs=h(bP,j(h(cr,co,cr),h(f('('),i,f(')')),h(i,B,i),h(i,aP,i)));var ct=j(bV,bU,bW,Z,bF,cm);var cu=h(bP,j(h(ct,co,ct),h(f('('),i,f(')')),h(i,B,i),h(i,aP,i)));var cv=j(bV,bU,bW,Z,bF,ce);var cw=h(bP,j(h(cv,co,cv),h(f('('),i,f(')')),h(i,B,i),h(i,aP,i)));var cx=j(bV,bU,bW,Z,bF,ci);var cy=h(bP,j(h(cx,co,cx),h(f('('),i,f(')')),h(i,B,i),h(i,aP,i)));var cz=j(bV,bU,bW,Z,bF,ck);var cA=h(bP,j(h(cz,co,cz),h(f('('),i,f(')')),h(i,B,i),h(i,aP,i)));var cB=j(bV,bU,bW,Z,bF,bZ);var cC=h(bP,j(h(cB,co,cB),h(f('('),i,f(')')),h(i,B,i),h(i,aP,i)));var cD=l(bH,bS,an,by);var cE=g(bV,1,1);var cF=g(s,1,1);var cG=l(bF,Z);var cH=g(u,1,1);var cI=l(t,bV);var cJ=g(s,1,1);var cK=e(l(cE,cJ,cH),cD,1,undefined,false);var cL=h(ar,bU);var cM=h(D,bW);var cN=h(y,bW);var cO=h(G,bW,B,bW);var cP=e(bT,f(','),1,undefined,false);var cQ=h(aW,bV);var cR=h(bw,bV);var cS=h(S,f('('),a(bW),f(')'));var cT=h(R,f('('),e(bW,f(','),0,2,false),f(')'));var cU=h(ay,f('('),bW,f(')'));var cV=h(az,f('('),bW,f(')'));var cW=h(aA,f('('),bW,f(')'));var cX=h(aB,f('('),bW,f(')'));var cY=h(bx,f('('),bW,f(')'));var cZ=h(aE,f('('),bW,f(')'));var de=h(av,f('('),bW,f(')'));var df=h(L,f('('),bW,f(')'));var dg=h(bN,f('('),bW,f(')'));var dh=h(aX,f('('),bW,f(')'));var di=h(ab,f('('),a(l(J,c('== != <= >= < >'))),l(bV,n,o),f(')'));var dj=h(bf,f('('),a(l(J,c('== != <= >= < >'))),l(bV,n,o),f(')'));var dk=e(l(cU,cY,cV,cW,cX,cZ,de,df,dg,dh,cS,cT,di,dj),f('=>'),1,undefined,false);var dl=h(l(aS,dk),a(cQ),a(cR));var dm=h(aD,C,bV,a(h(bL,dk)));var dn=h(bl,I,bV);var dp=h(bl,aQ,bV);var dq=h(bl,al,cG);var dr=h(bl,x,bV);var ds=h(bl,aV,o);var dt=h(bl,aq,bV);var du=h(bl,Q,cG);var dv=h(bl,at,bV);var dw=h(bl,aG,bV);var dx=h(bl,ak,cG);var dy=h(bl,U,n);var dz=h(bl,aZ,n);var dA=h(bl,bC,bV);var dB=h(bl,aw,o);var dC=h(bl,ax,o);var dD=h(bl,Y,u);var dE=h(ad,u);var dF=h(bJ,bV,dp);var dG=h(aH,bV,dn);var dH=h(ah,cF,l(dD,dq));var dI=h(bj,cI,l(dr,ds,du,dv));var dJ=h(N,l(dt,dy,dz,dA,dB,dC));var dK=h(bi,cE,dw);var dL=h(ai,a(cs));var dM=h(ai,bi,a(cs));var dN=h(aI,a(cA));var dP=h(aU,a(cu));var dQ=h(aU,l(bi,bk),a(cu));var dR=h(bi,a(cK),a(cq));var dS=h(bk,a(cw));var dT=h(bk,l(bd,aC,aM),a(cw));var dU=h(bp,a(cC));var dV=h(bp,bs,a(cC));var dW=h(bK,a(cy));var dX=h(bi,ao,a(cK),a(cq));var dY=h(ah,cF,dE,a(dq));var dZ=h(bJ,bV,dp);var ef=h(aH,bV,a(dn));var eg=h(ah,cF);var eh=h(bi,l(cK,cq,h(cK,cq)),a(dx));var ei=h(bm,o);var ej=h(bp,a(cC),a(dx));var ek=h(bj,cI);var el=h(bJ,bV);var em=h(aH,bV);var en=h(bJ,bV,a(dp));var eo=h(aH,bV,a(dn));var ep=h(ai,a(ch),a(cs));var eq=h(aI,a(cl),a(cA));var er=h(aU,a(cn),a(cu));var es=h(bi,a(bY),a(cK),a(cq));var et=h(bk,a(cf),a(cw));var eu=h(bp,a(cd),a(cC));var ev=h(bK,a(cj),a(cy));var ew=h(bJ,bV);var ex=h(aH,bV);var ey=h(A,l(dF,dG,dH,dI,dJ,dK));var ez=g(bW,1,1);var eA=h(K,cI);var eB=h(L,l(dL,dM,dN,dP,dQ,dR,dS,dT,dU,dV,dW,dX));var eC=h(M,l(dY,dZ,ef));var eD=h(T,l(eg,eh,ei,ej,ek,el,em));var eE=h(ag,cP,bE,l(en,eo));var eF=h(as,l(es,ev,eq,eu,ep,et,er),a(cL));var eG=h(aR,cI);var eH=h(bg,cP,ae,l(ew,ex));var eI=h(bh,e(dl,f(','),1,undefined,false),ae,cK,a(cq),a(l(cN,cO,cM)),a(dm));var eJ=l(F,E,O,P,Q,U,V,W,aq,at,au,aw,ax,aC,aM,aN,aO,aT,aY,aZ,bd,be,bj,bn,bo,bu,bv,bz,bA,bC,bD,z,bI,bM,bO,bQ);var eK=h(bq,e(eJ,f(','),0,undefined,false));var eL=g(bB,1,1);var eM=m('grant');var eN=m('timeit');var eO=m('select');var eP=m('timezones');var eQ=m('group');var eR=m('network');var eS=m('series');var eT=m('user');var eU=m('database');var eV=m('server');var eW=h(A,a(l(eQ,eR,eS,eT,eU,eV)));var eX=m('access');var eY=m('noaccess');var eZ=m('show');var fg=m('group');var fh=m('user');var fi=m('network');var fj=h(M,a(l(fg,fh,fi)));var fk=m('group');var fl=m('network');var fm=m('shard');var fn=m('series');var fo=m('user');var fp=m('server');var fq=h(T,a(l(fk,fl,fm,fn,fo,fp)));var fr=m('users');var fs=m('servers');var ft=m('shards');var fu=m('pools');var fv=m('series');var fw=m('networks');var fx=m('groups');var fy=h(L,a(l(fr,fs,ft,fu,fv,fw,fx)));var fz=m('functions');var fA=m('networks');var fB=m('series');var fC=m('shards');var fD=m('servers');var fE=m('users');var fF=m('groups');var fG=m('pools');var fH=h(as,a(l(fA,fB,fC,fD,fE,fF,fG)));var fI=m('revoke');var fJ=m('pause');var fK=m('continue');var fL=h(aj,a(l(eM,eN,eO,eP,eW,eX,eY,eZ,fj,fq,fy,fz,fH,fI,fJ,fK)));var fM=h(a(eL),a(l(eI,eF,eB,ey,eA,eC,eD,eE,eG,eH,eK,ez,fL)),a(v));window.SiriGrammar=d(fM,'[a-z_]+');})(window.jsleri.Optional,window.jsleri.Rule,window.jsleri.Tokens,window.jsleri.Grammar,window.jsleri.List,window.jsleri.Token,window.jsleri.Repeat,window.jsleri.Sequence,window.jsleri.THIS,window.jsleri.Prio,window.jsleri.Regex,window.jsleri.Choice,window.jsleri.Keyword);'use strict';$(document).ready(function(){$('.navbar-collapse a').click(function(){if($('.navbar-collapse').is(':visible')&&$('.navbar-toggle').is(':visible'))$('.navbar-collapse').collapse('toggle');});});(function(a,b,c,d,e,f,g){var h={};h.history=[];h.historyPos=0;h.addToHistory=false;h.historyMax=100;h.applyCode=function(){$('#contentholder code').not('pre > code').addClass('pointer').click(function(){h.setQuery($(this).text());});};var i=function(a){var b={s:1e3,ms:1e0,us:1e-3,ns:1e-6}[h.db.time_precision];return moment(Math.floor(a*b)).utc().format('YYYY-MM-DD HH:mm:ss')+'Z';};h.openModal=function(){$('#modal-database').html(h.db.dbname);$('#modal-version').html(h.db.version);$('#modal-license').html(h.db.license.replace(' (expires','<br />(expires'));};h.licenseModal=function(){$('#license-message-container,#btn-close-license-modal').hide();$('#insert-license-code-group,#btn-change-license').show();$('#btn-change-license,#license-code').prop('disabled',false);$('#license-code').val('').off().keydown(function(a){if(a.ctrlKey&&(a.keyCode==10||a.keyCode==13))h.changeLicense();$('#license-message-container').fadeOut(100);});$('#license-modal').off('shown.bs.modal').on('shown.bs.modal',function(){$('#license-code').focus();});};h.handleChangeLicenseError=function(a){if(a.status==422)window.location.hash='#auth';else try{var b=JSON.parse(a.responseText);if(b.hasOwnProperty('error_msg'))$('#license-message-container').fadeOut(100,function(){$('#license-message-container').html(['<div class="alert alert-warning">','<a href="#" class="close" data-dismiss="alert">&times;</a>','<strong>Error!</strong> '+b.error_msg,'</div>'].join('')).fadeIn(200);});}catch(c){$('#license-message-container').html('<div class="alert alert-danger">Some error occurred, please see the console for more details.</div>').fadeIn(100);}$('#btn-change-license,#license-code').prop('disabled',false);};h.changeLicense=function(){$('#btn-change-license,#license-code').prop('disabled',true);$('#license-message-container').html(['<div class="alert alert-info">','Please wait while we send the new license code to database <strong>'+h.db.dbname+'</strong>...','</div>'].join('')).fadeIn(200);$.post('/query',{q:'alter database set license "'+$('#license-code').val()+'"'},function(){$.post('/query',{q:'show license'},function(a){h.db.license=a.data[0].value;$('#insert-license-code-group,#btn-change-license').hide();$('#license-message-container').fadeOut(100,function(){$('#license-message-container').html(['<div class="alert alert-success">','Succesful changed license for database <strong>'+h.db.dbname+'</strong>!','</div>'].join('')).fadeIn(200);h.licenseWarning();$('#btn-close-license-modal').show();});},'json');}).error(h.handleChangeLicenseError);};h.handleSignInError=function(a){try{var b=JSON.parse(a.responseText);if(b.hasOwnProperty('error_msg'))$('#auth-message-container').html(['<div class="alert alert-warning">','<a href="#" class="close" data-dismiss="alert">&times;</a>','<strong>Error!</strong> '+b.error_msg,'</div>'].join('')).fadeIn(200);}catch(c){$('#auth-message-container').html('<div class="alert alert-danger">Some error occurred, please see the console for more details.</div>').fadeIn(100);}};h.licenseWarning=function(){if(h.db.license.toLowerCase().indexOf('registered')==-1)$('#license-warning-container').html('<strong>Warning!</strong> '+h.db.license+'. Click <a href="#" data-toggle="modal" data-target="#license-modal" onclick="app.licenseModal()">here</a> to enter a license code.').fadeIn(200);else $('#license-warning-container').hide();};h.signIn=function(a,b){var c=$('#username-input').val(),d=$('#password-input').val(),e=$('#database-selection').val();$.post('/sign-in',{u:c,p:d,d:e},function(){h.user=c;if(window.location.hash==='#auth')window.location.hash='#query';else h.render(a,b);}).error(h.handleSignInError);};h.setSeriesQuery=function(a){$('#query').val('select * from "'+a+'" after now - 1h').select().focus();h.addToHistory=true;};h.setGroupQuery=function(a){$('#query').val('list series `'+a+'`').select().focus();h.addToHistory=true;};h.setQuery=function(a){$('#query').val(a).select().focus();h.addToHistory=true;if(a.indexOf('help')===0)h.runQuery();};h.runQuery=function(){$('#btn-run-query').prop('disabled',true);$('#query').prop('disabled',true);var l=$('#query').val().trim();if(h.addToHistory){h.history.push(l);if(h.history.length>h.historyMax)h.history.shift();h.historyPos=h.history.length-1;}var m=function(){$('#messageholder').html('');$('#contentholder').html('');$('#btn-run-query').prop('disabled',false);$('#query').prop('disabled',false).focus().select();$(window).off('resize');h.addToHistory=false;};var n=function(a){var b={s:1e3,ms:1e0,us:1e-3,ns:1e-6}[h.db.time_precision];for(var c=0,d=a.points.length;c<d;c++)a.points[c][0]*=b;var e;var f=$('<div>').addClass('chart').bind('plothover',function(a,b,c){if(!c){$('#tooltip').remove();e=undefined;return;}if(c.datapoint[0]===e)return;e=c.datapoint[0];$('#tooltip').remove();if(c){var d=moment(c.series.data[c.dataIndex][0]);var f=d.format('YYYY-MM-DD HH:mm:ss');var g=f+'<br /><strong>'+c.series.data[c.dataIndex][1]+'</strong>';var h=function(a,b,c){$('<div id="tooltip">'+c+'</div>').css({'z-index':'2000',position:'absolute',display:'none',top:b-55,left:a-80,border:'1px solid #50636b','text-align':'center','border-radius':'0px',padding:'2px 10px',color:'#fff','background-color':'#50636b',opacity:0.85}).appendTo('body').fadeIn(200);};h(c.pageX,c.pageY,g);}});$('#contentholder').append(f);var g={series:{lines:{show:true,steps:false},points:{show:true}},xaxis:{mode:'time',timeformat:'%Y/%m/%d',font:{color:'#d4dee1'}},yaxis:{font:{color:'#d4dee1'}},grid:{color:'#d4dee1',hoverable:true,clickable:true,borderWidth:1,borderColor:'#d4dee1'},points:{radius:1},legend:{noColumns:2,labelBoxBorderColor:'#7898a0',backgroundColor:null,backgroundOpacity:0,position:'ne',margin:[0,-20],padding:[5,5]}};var i=[{label:a.name,data:a.points,color:'#fe9e1e'}];f.plot(i,g);$(window).resize(function(){f.plot(i,g);});};var o=function(b,c,d,e){var f=function(b){var d='';$.each(b,function(b,f){if(f instanceof Array){var g={};$.each(c,function(a,b){g[b]=f[a];});f=g;}d+='<tr>';$.each(c,function(b,c){if(c=='name'&&e=='series')d+='<td><a onclick="app.setSeriesQuery(\''+f[c]+'\')"><i class="fa fa-clipboard"></i></a> '+f[c]+'</td>';else if(c=='name'&&e=='groups')d+='<td><a onclick="app.setGroupQuery(\''+f[c]+'\')"><i class="fa fa-clipboard"></i></a> '+f[c]+'</td>';else if(((e=='show'&&f.name=='uptime'&&c=='value')||(e=='servers'&&c=='uptime'))&&(typeof f[c]!=='string'))d+='<td>'+moment.duration(f[c],'seconds').humanize()+'</td>';else if(((e=='show'&&f.name=='received_points'&&c=='value')||(e=='servers'&&c=='received_points'))&&(typeof f[c]!=='string'))d+='<td>'+a.formatLongNumber(f[c])+'</td>';else if(((e=='show'&&f.name=='buffer_size'&&c=='value')||(e=='servers'&&c=='buffer_size'))&&(typeof f[c]!=='string'))d+='<td>'+a.formatSize(f[c])+'</td>';else if(((e=='show'&&f.name=='mem_usage'&&c=='value')||(e=='servers'&&c=='mem_usage'))&&(typeof f[c]!=='string'))d+='<td>'+a.formatSize(f[c]*1024*1024)+'</td>';else if(((e=='show'&&f.name=='queries_timeout'&&c=='value')||(e=='servers'&&c=='queries_timeout'))&&(typeof f[c]!=='string'))d+='<td>'+f[c]+((f[c]===1)?' second':' seconds')+'</td>';else if(((e=='show'&&f.name=='max_open_files'&&c=='value')||(e=='servers'&&c=='max_open_files'))&&(typeof f[c]!=='string'))d+='<td>'+'Set: '+f[c][0]+' Actual: '+f[c][1]+'</td>';else if(((e=='show'&&f.name=='manhole'&&c=='value')||(e=='servers'&&c=='manhole'))&&(typeof f[c]==='string'))d+='<td>'+f[c]+((f[c].indexOf('not installed')>-1)?'':', example usage: socat - unix-connect:'+f[c])+'</td>';else if(e=='show'&&f.name=='drop_threshold'&&c=='value')d+='<td>'+f[c]+' ('+(parseInt(f[c]*100).toString())+'%)'+'</td>';else if(((e=='show'&&f.name=='startup_time'&&c=='value')||(e=='servers'&&c=='startup_time'))&&(typeof f[c]!=='string')){var g=Math.ceil(f[c]);d+='<td>'+g+((g===1)?' second':' seconds')+'</td>';}else if(e=='shards'&&(c=='start'||c=='end'))d+='<td>'+i(f[c])+'</td>';else if(e=='series'&&(c=='start'||c=='end'))d+='<td>'+i(f[c])+'</td>';else if(e=='points'&&(c=='timestamp'))d+='<td>'+i(f[c])+'</td>';else if(e=='shards'&&(c=='start'||c=='size'))d+='<td>'+a.formatSize(f[c])+'</td>';else d+='<td>'+f[c]+'</td>';});d+='</tr>';});return d;};$('#contentholder').append(['<table class="table table-striped table-condensed">',b?'<caption><div style="border:1px solid #7898a0;padding:1px;float:left;margin-right:5px"><div style="width:4px;height:0;border:5px solid #fe9e1e;overflow:hidden"></div></div>'+b+'</caption>':'','<thead>','<tr>',function(a){var b='';$.each(a,function(a,c){b+='<th>'+c+'</th>';});return b;}(c),'</tr>','</thead>','<tbody>',f(d),'</tbody>','</table>'].join(''));};var p=function(a,b,c){var d=$('<div class="alert alert-info">');if(b)d.text('Got '+b.toString()+' '+c+(b>1?'s':'')+' in '+a.__timeit__[0].time.toFixed(3)+' seconds');else d.text('Query time: '+a.__timeit__[0].time.toFixed(3)+' seconds');d.append(['<dl class="dl-horizontal">',function(a){var b='';$.each(a,function(a,c){b+='<dt>'+c.time.toFixed(3)+'</dt><dd>'+c.server+'</dd>';});return b;}(a.__timeit__),'</dl>'].join(''));$('#contentholder').append(d);};var q=function(l,m,n){if(l.columns!==undefined&&typeof l.columns[0]==='string'){if(l.__timeit__!==undefined){p(l,n,'row');delete l.__timeit__;}if(l.pools!==undefined){var q=a.sortOn(l.pools,l.columns.indexOf('pool'));return o(null,l.columns,q,'pools');}if(l.networks!==undefined)return o(null,l.columns,l.networks);if(l.users!==undefined){var s=a.sortOn(l.users,l.columns.indexOf('user'));return o(null,l.columns,s,'users');}if(l.shards!==undefined){var t=a.sortOn(l.shards,l.columns.indexOf('sid')).reverse();return o(null,l.columns,t,'shards');}if(l.servers!==undefined){var u=a.sortOn(l.servers,l.columns.indexOf('name'));return o(null,l.columns,u,'servers');}if(l.series!==undefined){var v=a.sortOn(l.series,l.columns.indexOf('name'));return o(null,l.columns,v,'series');}if(l.groups!==undefined){var w=a.sortOn(l.groups,l.columns.indexOf('name'));return o(null,l.columns,w,'groups');}}if(l.__timeit__!==undefined){p(l,n,'point');delete l.__timeit__;}if(l.success_msg!==undefined&&typeof l.success_msg==='string')return $('#contentholder').append('<div class="alert alert-success">'+l.success_msg+'</div>');if(l.pools!==undefined&&!isNaN(l.pools))return $('#contentholder').append('<div class="alert alert-info">'+l.pools.toString()+'</div>');if(l.pools_servers!==undefined&&!isNaN(l.pools_servers))return $('#contentholder').append('<div class="alert alert-info">'+l.pools_servers.toString()+'</div>');if(l.users!==undefined&&!isNaN(l.users))return $('#contentholder').append('<div class="alert alert-info">'+l.users.toString()+'</div>');if(l.servers!==undefined&&!isNaN(l.servers))return $('#contentholder').append('<div class="alert alert-info">'+l.servers.toString()+'</div>');if(l.groups!==undefined&&!isNaN(l.groups))return $('#contentholder').append('<div class="alert alert-info">'+l.groups.toString()+'</div>');if(l.servers_open_files!==undefined&&!isNaN(l.servers_open_files))return $('#contentholder').append('<div class="alert alert-info">'+l.servers_open_files.toString()+'</div>');if(l.networks!==undefined&&!isNaN(l.networks))return $('#contentholder').append('<div class="alert alert-info">'+l.networks.toString()+'</div>');if(l.shards!==undefined&&!isNaN(l.shards))return $('#contentholder').append('<div class="alert alert-info">'+l.shards.toString()+'</div>');if(l.series!==undefined&&!isNaN(l.series))return $('#contentholder').append('<div class="alert alert-info">'+a.formatLongNumber(l.series)+'</div>');if(l.groups_series!==undefined&&!isNaN(l.groups_series))return $('#contentholder').append('<div class="alert alert-info">'+a.formatLongNumber(l.groups_series)+'</div>');if(l.pools_series!==undefined&&!isNaN(l.pools_series))return $('#contentholder').append('<div class="alert alert-info">'+a.formatLongNumber(l.pools_series)+'</div>');if(l.series_length!==undefined&&!isNaN(l.series_length))return $('#contentholder').append('<div class="alert alert-info">'+a.formatLongNumber(l.series_length)+'</div>');if(l.servers_received_points!==undefined&&!isNaN(l.servers_received_points))return $('#contentholder').append('<div class="alert alert-info">'+a.formatLongNumber(l.servers_received_points)+'</div>');if(l.servers_mem_usage!==undefined&&!isNaN(l.servers_mem_usage))return $('#contentholder').append('<div class="alert alert-info">'+a.formatSize(l.servers_mem_usage*1024*1024)+'</div>');if(l.shards_size!==undefined&&!isNaN(l.shards_size))return $('#contentholder').append('<div class="alert alert-info">'+a.formatSize(l.shards_size)+'</div>');if(l.calc!==undefined&&!isNaN(l.calc)){var x={s:1e0,ms:1e-3,us:1e-6,ns:1e-9}[h.db.time_precision];var y=parseInt(l.calc*x);var z;if(y<315532800)z=moment.duration(y,'seconds').humanize();else z=i(l.calc);var A=$('<span data-toggle="tooltip" data-placement="bottom" title="'+z+'">'+l.calc.toString()+'</span>').tooltip().click(function(){$(this).tooltip('hide');});var B=$('<div class="alert alert-info"></div>');A.appendTo(B);return $('#contentholder').append(B);}if(l.data!==undefined&&l.data instanceof Array&&l.data.length&&l.data[0].name!==undefined)return o(null,['name','value'],l.data,'show');if(l.help&&typeof l.help==='string'){var C=new b.Converter();var D=$('<div>').addClass('help-content');D.append(C.makeHtml(l.help));$('#contentholder').append(D).find('pre').each(function(a,b){var h=$(b).children('code').first().html().split('\n');var i,l,m,n,o,p,q,r,s;for(i=0,m=h.length;i<m;i++){o=h[i].replace(/&amp;/g,'&').replace(/&gt;/g,'>').replace(/&lt;/g,'<');p=c.parse(o);if(p.isValid){q=[];j(p.tree,q);q.reverse();for(l=0,n=q.length;l<n;l++){r=q[l];if(r.element instanceof d)s='<span class="siri-keyword">'+r.str+'</span>';else if(r.element instanceof e)if(r.str[0]=='#')s='<span class="siri-comment">'+r.str+'</span>';else if(r.str[0]=='\''||r.str[0]=='"')s='<span class="siri-string">'+r.str+'</span>';else s='<span class="siri-regex">'+r.str+'</span>';else if(r.element instanceof f||r.element instanceof g)s='<span class="siri-token">'+r.str+'</span>';o=k(o,r.start,r.end,s);}h[i]=o;}}$(b).children('code').first().html(h.join('\n'));});h.applyCode();return;}if(m)r(l);return;};var r=function(a){for(var b in a)if(!a[b].length)$('#contentholder').append('<div class="alert alert-info">the current query for '+b+' has no results</div>');else if(typeof a[b][0][1]!=='string')n({name:b,points:a[b]});else o(b,['timestamp','value'],a[b],'points');};var s=function(a){var b=0;for(var c in a)if(a[c] instanceof Array&&a[c].length&&a[c][0] instanceof Array)b+=a[c].length;return b;};$.post('/query',{q:l,t:h.db.time_precision},function(a){m();var b=s(a),c=b<10000;if(!c){var d=$('<div class="alert alert-warning">').html('We have found <strong>'+b+'</strong> points. Rendering this data can take up a long time...<br /><br />');var e=$('<button>').addClass('btn btn-primary').text('just show the data').click(function(){$('#contentholder').html('');r(a);});d.append(e);$('#contentholder').append(d);}q(a,c,b);},'json').error(function(a){if(a.status==422)window.location.hash='#auth';else{m();try{var b=JSON.parse(a.responseText);if(b.hasOwnProperty('error_msg'))$('#contentholder').append('<div class="alert alert-warning">'+b.error_msg+'</div>');}catch(c){$('#messageholder').html('<div class="alert alert-danger">Some error occurred, please see the console for more details.</div>');}}});};function j(a,b){if(a.element instanceof d||a.element instanceof e||a.element instanceof f||a.element instanceof g)b.push(a);for(var c=0,h=a.children.length;c<h;c++)j(a.children[c],b);}function k(a,b,c,d){return a.slice(0,b)+(d||'')+a.slice(c);}h.runInsert=function(a,b){var c=$(b).parent().find('textarea').first().val().trim();$.post('/insert-'+a,c,function(a){if(a.hasOwnProperty('success_msg'))$('#insert-message-container').html(['<div class="alert alert-success">','<a href="#" class="close" data-dismiss="alert">&times;</a>','<strong>Success!</strong> '+a.success_msg,'</div>'].join(''));else window.console.error(a);},'json').error(function(a){if(a.status==422)window.location.hash='#auth';else try{var b=JSON.parse(a.responseText);if(b.hasOwnProperty('error_msg'))$('#insert-message-container').html(['<div class="alert alert-danger">','<a href="#" class="close" data-dismiss="alert">&times;</a>','<strong>Error!</strong> '+b.error_msg,'</div>'].join(''));}catch(c){$('#insert-message-container').html('<div class="alert alert-danger">Some error occurred, please see the console for more details.</div>');}});};window.app=h;})(window.oz,window.showdown,window.SiriGrammar,window.jsleri.Keyword,window.jsleri.Regex,window.jsleri.Token,window.jsleri.Tokens);'use strict';(function(a,b,c,d,e,f,g){var h=/[a-z_]+$/;var i=/^[a-z_]+/;var j=-1,k=0;var l=function(a,d){if(a.selectionStart!==a.selectionEnd)return;var e,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;e=b(a);l=a.selectionStart;m=e.val();s=m.substring(0,l);t=m.substring(l);r=s.match(h);w=r?r[0]:'';u=(w&&(u=t.match(i)))?u[0]:'';if(r===null)r={index:l};z=f.parse(s);if((d===undefined||!z.isValid)&&z.pos===r.index){y=[];for(n=0,p=z.expecting.length;n<p;n++){x=z.expecting[n];if(x instanceof g)if(x.keyword.indexOf(w)===0)y.push(x.keyword);}y.sort();p=y.length;if(p==1){v=y[0].substring(w.length);e.val(m.slice(0,l)+v+m.slice(l));l+=v.length;a.selectionStart=l;a.selectionEnd=l;c.insertSpace();}else if(p>1){for(n=0;true;n++){q=y[0][n];for(o=1;o<p;o++)if(q!==y[o][n]||o>y[o].length){o=0;break;}if(o!==p)break;}v=y[0].substring(0,n);e.val(m.slice(0,l)+v.slice(w.length)+m.slice(l+u.length));l+=(v.length-w.length);a.selectionStart=l;a.selectionEnd=l;j=-1;k=p;b('#autocomplete-popup').css('left',Math.min(14+(l*7),e.width())).show().children('ul').html(function(a,b,c){var d='';for(var e=0;e<b;e++)d+='<li data-index="'+e+'" onclick="app.insertText(\''+y[e].substring(c)+'\', 0)">'+'<span class="grey">'+y[e].substring(0,c)+'</span>'+y[e].substring(c)+'</li>';return d;}(y,p,n)).children('li').hover(function(){b('#autocomplete-popup ul').children('li').removeClass('selected-auto-complete');j=b(this).addClass('selected-auto-complete').data('index');});}}};var m=function(a,c,d,e){var f=b(a);var g=f.val();var h=a.selectionStart;var i=a.selectionStart!==a.selectionEnd;if(!i&&g[h]==d){a.selectionStart++;return;}f.val(g.slice(0,a.selectionStart)+c+g.slice(a.selectionStart,a.selectionEnd)+d+g.slice(a.selectionEnd));if(i){a.selectionStart=h;a.selectionEnd++;}else a.selectionEnd=a.selectionStart=h+e;};var n=function(){c.applyCode();b('#contentholder .name-holder').html(c.db.who_am_i);c.historyPos=c.history.length;b('#query').select().focus().keypress(function(a){var b=String.fromCharCode(a.which);if(b==='('){a.preventDefault();m(this,'(',')',1);}else if(b==='`'){a.preventDefault();m(this,'`','`',1);}else if(b==='"'){a.preventDefault();m(this,'"','"',1);}else if(b==='\''){a.preventDefault();m(this,'\'','\'',1);}else if(b===')'){a.preventDefault();m(this,'',')',1);}});b('#query').select().focus().keydown(function(a){var d=b('#autocomplete-popup');var e=d.is(':visible');var f;if(a.keyCode===10||a.keyCode===13){a.preventDefault();if(!e)c.runQuery();else if(j>=0)b('.selected-auto-complete').click();}else if(a.keyCode===38){a.preventDefault();if(!e&&c.historyPos){c.historyPos-=1;b(this).val(c.history[c.historyPos]).select().focus();c.addToHistory=false;}else if(e){f=d.find('.selected-auto-complete').removeClass('selected-auto-complete');if(j<=0)j=d.find('li:last').addClass('selected-auto-complete').data('index');else{f.prev().addClass('selected-auto-complete');j--;}}}else if(a.keyCode===40){a.preventDefault();if(!e&&c.historyPos<c.history.length){c.historyPos+=1;if(c.historyPos<c.history.length){b(this).val(c.history[c.historyPos]).select().focus();c.addToHistory=false;}else b(this).val('');}else if(e){f=d.find('.selected-auto-complete').removeClass('selected-auto-complete');if(j===-1||j>=k-1)j=d.find('li:first').addClass('selected-auto-complete').data('index');else{f.next().addClass('selected-auto-complete');j++;}}}else if(a.keyCode===9){a.preventDefault();d.hide();l(this);}else{d.hide();c.addToHistory=true;}});};var o=function(){b('#view').html(b('#auth-view').html());b('#username-input,#password-input,#database-selection').keydown(function(a){if(a.keyCode==10||a.keyCode==13)c.signIn(c.nextView,c.nextCallback);else b('#auth-message-container').fadeOut(100);});b('#username-input').select().focus();};c.render=function(a,d){b(window).off('resize');if(c.user&&c.db){var e=b(a);if(e.length)b('#view').html(e.html());b('.navbar-nav li').removeClass('active');b('.navbar-nav li[data-target="'+a+'"]').addClass('active');c.licenseWarning();if(d)d();}else if(c.user)b.get('/database-info',function(b){c.db=b;c.render(a,d);},'json').error(function(a){o();c.handleSignInError(a);});else b.post('/sign-in',function(b){c.user=b;c.render(a,d);}).error(function(){c.nextView=a;c.nextCallback=d;o();});};c.authView=function(){b.post('/sign-out');c.history=[];c.historyPos=0;c.addToHistory=false;c.db=null;c.user=null;c.nextView='#query-view';c.nextCallback=n;o();};c.insertSpace=function(){var a=b('#query');var c=a[0];var d=c.selectionStart;var e=a.val();if(e[d]!==' ')a.val(e.slice(0,d)+' '+e.slice(d));c.selectionStart=d+1;c.selectionEnd=c.selectionStart;};c.insertText=function(a,d){b('#autocomplete-popup').hide();var e=b('#query');var f=e[0];var g=f.selectionStart;var h=e.val();e.val(h.slice(0,g)+a+h.slice(g));e.focus();f.selectionStart=g+a.length+d;f.selectionEnd=f.selectionStart;c.insertSpace();};c.queryView=function(){c.render('#query-view',n);};var p=function(){b('#insert-form-json-array,#insert-form-json-object,#insert-form-csv-flat,#insert-form-csv-table').hide();b('#insert-form-'+b('input[name=insert-type]:checked').val()).show();};c.insertView=function(){c.render('#insert-view',function(){b('input[name=insert-type]').change(p);p();var a={s:1e-3,ms:1e0,us:1e3,ns:1e6}[c.db.time_precision];b('#insert-csv-table').val(',"series-001"\n'+Math.floor(d()*a)+','+Math.floor((Math.random()*100)+1)+'\n');b('#insert-csv-flat').val('"series-001",'+Math.floor(d()*a)+','+Math.floor((Math.random()*100)+1)+'\n');b('#insert-csv-table,#insert-csv-flat').keydown(function(a){if(a.ctrlKey&&(a.keyCode==10||a.keyCode==13))c.runInsert('csv',b(a.target).parent().parent().find('button').first());});b('#insert-json-array').val('[\n\t{\n\t\t"name": "series-001",\n\t\t"points": [\n\t\t\t['+Math.floor(d()*a)+', '+Math.floor((Math.random()*100)+1)+']\n\t\t]\n\t}\n]');b('#insert-json-object').val('{\n\t"series-001": [\n\t\t['+Math.floor(d()*a)+', '+Math.floor((Math.random()*100)+1)+']\n\t]\n}');b('#insert-json-array,#insert-json-object').keydown(function(a){var d=b(this);var e=d.val();if(a.ctrlKey&&(a.keyCode==10||a.keyCode==13))c.runInsert('json',a.target);if(a.which==9){a.preventDefault();var f=this.selectionStart;var g=this.selectionEnd;d.val(e.substring(0,f)+'\t'+e.substring(g));this.selectionStart=this.selectionEnd=f+1;}}).keyup(function(){try{JSON.parse(b(this).val());b(event.target).parent().removeClass('has-error');b(event.target).parent().parent().find('button').first().prop('disabled',false);}catch(a){b(event.target).parent().addClass('has-error');b(event.target).parent().parent().find('button').first().prop('disabled',true);}});b('#insert-json-object').select().focus();});};a({'':function(){c.queryView();},'query':function(){c.queryView();},'insert':function(){c.insertView();},'auth':function(){c.authView();},'*':function(){c.render('#page-not-found-view');}});})(window.routie,window.jQuery,window.app,window.moment,window.oz,window.SiriGrammar,window.jsleri.Keyword,window.jsleri.Token);