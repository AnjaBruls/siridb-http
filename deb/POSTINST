#!/bin/bash

set -e

case "$1" in

  configure)
    # Set up SiriDB HTTP
    if which deb-systemd-invoke >/dev/null 2>&1 && pidof systemd >/dev/null 2>&1; then
        OUTPUT=`deb-systemd-invoke status siridb-http || true`
        if [[ $OUTPUT == *"running"* ]]; then
            echo "--------------------------------------------------------------------------------"
            echo "|  type 'sudo systemctl restart siridb-http.service' to restart SiriDB       |"
            echo "|  ...or just reboot the machine.                                              |"
            echo "--------------------------------------------------------------------------------"
        else
            echo "Configure systemd service 'siridb-http' ..."
            cp /usr/lib/siridb/http/systemd/siridb-http.service /lib/systemd/system/siridb-http.service
            systemctl daemon-reload || true
            deb-systemd-invoke enable siridb-http 2>/dev/null >/dev/null || true
            echo "--------------------------------------------------------------------------------"
            echo "|  type 'sudo systemctl start siridb-http.service' to start SiriDB           |"
            echo "|  ...or just reboot the machine.                                              |"
            echo "--------------------------------------------------------------------------------"
        fi
    else
        echo "--------------------------------------------------------------------------------"
        echo "|  Please use supervisor or another deamon to start SiriDB HTTP              |"
        echo "|  It's also possible to start SiriDB manually using 'sudo siridb-http'      |"
        echo "--------------------------------------------------------------------------------"
    fi
  ;;

  abort-upgrade|abort-remove|abort-deconfigure)
    exit 0
  ;;

  *)
    echo "postinst called with unknown argument \`$1'" >&2
    exit 1
  ;;

esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0